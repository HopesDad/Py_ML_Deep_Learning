
##딥러닝 모델 Serving 간단 구축기 (feat. AWS SQS + Python Application + Kubernetes + Git & Rancher)<br>


- 차량을 대여 하기 전 가장 먼저 하는 일은 그 전의 소비자가 차를 손상을 가했는지 확인하는 절차가 매우 중요하다. 나중에 반납할 때 손상이 발견되면 
해당 건의 책임을 본인이 직접 물어주는 불상사가 발생한다. 이를 막기 위해서는 소비자들의 전송된 사진을 직접 검수하는 작업을 하였다.

- 그래서 socar는 이에 따라, 이미지를 확인하고 차량의 손상을 판정하는 과정에 댛나 자동화 방안을 찾아보게 되었고, DL(Deep Learning)을 이용하여 
손상을 판정하는 모델을 개발하여 이를 운영하는 시스템을 구축하는 시스템 프로젝트 진행이 되었습니다.

### 딥러닝 모델을 서빙하기 위한 시스템은 어떻게 구성할까?<
딥러닝 모델을 개발할 때는 Input과 Output이 비교적 명확한 편입니다. 이미지를 분석하여 차량 파손을 탐지하는 모델의 경우에는 Input으로 차량 이미지(JPG, PNG 등)를 받고, Output으로 차량의 파손과 관련된 정보(파손 종류, 파손 확률 등)와 파손 영역이 표시된 결과 이미지를 생성하게 됩니다.

그런데 딥러닝 모델을 실제 시스템과 결합하여 사용할 때에는 고려할 사항들이 좀 더 많아지고 복잡해지게 됩니다.
사용자가 찍어 올리는 차량 이미지를 딥러닝 모델을 구동하는 머신에 다운로드 받아야 하고, 판정 결과는 시스템이 원하는 장소에 파일로 저장하거나 또는 데이터베이스에 저장하기도 합니다. 딥러닝 모델을 운영하려면 시스템 성능도 중요하게 고려해야 하는데, 이미지를 판정하는 처리량(시간당 몇 장의 이미지를 판정할 수 있는가)이 실제 이미지 업로드 양을 감당할 수 있어야 하기 때문입니다.

쏘카의 경우, 차량 파손 판정 DL 모델을 서빙하기 위해 고려할 사항은 다음과 같았습니다.

- 현재 차량 검수 운영 방식 (전반적인 프로세스 확인)
- 모델이 판정해야 하는 이미지의 수량 (시간당 처리량 판단)
- 어떻게 이미지를 모델에 전달할 것인가?
- 이미지 판정 결과는 어떻게 전달할 것인가?
- 전체 시스템의 동작 상태를 확인할 수 있는 방법은?

위와 같은 고려 사항과 요구 사항들을 만족시키기 위해, 딥러닝 모델 서빙을 위한 다양한 방안들에 대해 리뷰했습니다. 
현재 각 클라우드 플랫폼들이 제공하는 모델 서빙 시스템 중 대표적인 것으로 Kubeflow, SageMaker, AutoML 등이 있습니다. 이와 같은 서비스들은 모델의 학습부터 배포, 
서빙에 이르기까지 모든 기능을 제공하는 End-to-End platform입니다.
--------------------------------------------------------------------------------------
- socar 데이터 엔지니어팀에서는 딥러닝 모델을 안정적으로 서빙하는 것에 포커스를 두고, 빠른 시간에 설계 및 개발을 완료하여 사내 시스템과 통합하는 것이 목표입니다.
몇 번의 논의와 수정을 거쳐 최종적으로 결정된 시스템은 아래 그림과 같습니다.




